# 提示词设置

提示词是 YesImBot 与语言模型交互的核心组件，它决定了机器人的回应风格、内容和行为。本章将详细介绍如何配置和优化提示词，以获得最佳的交互体验。

## 提示词概述

提示词（Prompt）是发送给语言模型的指令文本，它引导模型生成符合预期的回应。在 YesImBot 中，提示词由多个组件组成，包括系统提示词、人格描述、上下文信息和当前消息等。

## 基本配置

提示词的基本配置主要包括系统提示词和提示词模板：

```yaml
Prompts:
  SystemPrompt: "你是一个名为 {bot_name} 的智能助手，你的任务是在群聊中自然地参与对话，提供有用的信息和友好的交流。"
  PromptTemplate: |
    <system>
    {system_prompt}
    
    你的人格：{personality}
    </system>
    
    <context>
    {context}
    </context>
    
    <conversation>
    {conversation_history}
    </conversation>
    
    <current_message>
    {current_message}
    </current_message>
```

### 系统提示词

系统提示词（System Prompt）是提供给语言模型的基本指令，它定义了机器人的角色和任务。系统提示词应该简洁明了，包含以下要素：

1. 机器人的身份（"你是谁"）
2. 机器人的任务（"你应该做什么"）
3. 机器人的行为准则（"你应该如何表现"）

系统提示词中可以使用变量，如 `{bot_name}`，这些变量会在运行时被替换为实际值。

### 提示词模板

提示词模板（Prompt Template）定义了发送给语言模型的完整提示词的结构。它通常包含以下部分：

1. **系统部分**：包含系统提示词和人格描述
2. **上下文部分**：包含当前会话的背景信息
3. **对话历史部分**：包含之前的对话记录
4. **当前消息部分**：包含用户的最新消息

提示词模板中的各部分可以使用不同的标记（如 `<system>`、`<context>` 等）分隔，这些标记有助于语言模型理解提示词的结构。

## 变量系统

YesImBot 的提示词系统支持多种变量，这些变量会在运行时被替换为实际值：

| 变量名 | 描述 | 示例 |
|-------|------|------|
| `{bot_name}` | 机器人的名称 | "Athena" |
| `{personality}` | 机器人的人格描述 | "友好、知识渊博的AI助手" |
| `{system_prompt}` | 系统提示词 | "你是一个名为Athena的智能助手..." |
| `{context}` | 当前会话的上下文信息 | "这是一个技术讨论群，主题是人工智能..." |
| `{conversation_history}` | 之前的对话记录 | "用户A: 你好\nAthena: 你好，有什么我能帮助你的吗？" |
| `{current_message}` | 用户的最新消息 | "用户B: 能解释一下什么是机器学习吗？" |
| `{current_time}` | 当前时间 | "2025-06-03 16:30:00" |
| `{group_name}` | 当前群组的名称 | "AI爱好者交流群" |
| `{sender_name}` | 发送消息的用户名称 | "用户B" |

## 高级配置

除了基本配置外，提示词系统还提供了一些高级配置选项，用于进一步优化机器人的回应：

```yaml
Prompts:
  ContextEnhancement: true       # 是否启用上下文增强
  ContextEnhancementPrompt: "请根据以下对话历史，总结当前的讨论主题和关键信息：\n{conversation_history}"
  ResponseFormatting: true       # 是否启用回应格式化
  ResponseFormattingPrompt: "请以简洁、友好的方式回应，避免过长的回复，保持对话的自然流畅。"
  SpecialPrompts:                # 特殊情况的提示词
    Greeting: "有新用户加入群聊时，请简短地欢迎他们。"
    LongSilence: "当群聊长时间没有活动后，你可以适当地发起一些有趣的话题。"
    HighActivity: "当群聊非常活跃时，请保持简短的回应，不要打断对话流。"
```

### 上下文增强

上下文增强功能使用额外的提示词处理对话历史，生成更有用的上下文信息：

| 参数名 | 描述 | 默认值 |
|-------|------|-------|
| `ContextEnhancement` | 是否启用上下文增强 | true |
| `ContextEnhancementPrompt` | 用于生成增强上下文的提示词 | "请根据以下对话历史..." |

上下文增强可以帮助机器人更好地理解当前的讨论主题和关键信息，从而生成更相关的回应。

### 回应格式化

回应格式化功能使用额外的提示词控制机器人回应的格式和风格：

| 参数名 | 描述 | 默认值 |
|-------|------|-------|
| `ResponseFormatting` | 是否启用回应格式化 | true |
| `ResponseFormattingPrompt` | 用于格式化回应的提示词 | "请以简洁、友好的方式回应..." |

回应格式化可以确保机器人的回应符合预期的风格和格式，例如控制回应的长度、语气和结构。

### 特殊提示词

特殊提示词用于处理特定情况下的回应：

| 参数名 | 描述 | 示例 |
|-------|------|------|
| `SpecialPrompts.Greeting` | 新用户加入群聊时的提示词 | "有新用户加入群聊时..." |
| `SpecialPrompts.LongSilence` | 群聊长时间没有活动时的提示词 | "当群聊长时间没有活动后..." |
| `SpecialPrompts.HighActivity` | 群聊非常活跃时的提示词 | "当群聊非常活跃时..." |

特殊提示词可以帮助机器人在不同的情境下生成更适当的回应，提高交互的自然度和用户体验。

## 场景提示词

场景提示词是针对特定场景定制的提示词，它们可以根据对话内容和上下文动态应用：

```yaml
Prompts:
  ScenarioPrompts:
    - Name: "问答场景"
      Keywords:
        - "问题"
        - "如何"
        - "为什么"
      Prompt: "这是一个问答场景，请提供准确、有帮助的回答。尽量使用事实和数据支持你的观点。"
      Priority: 10
    
    - Name: "闲聊场景"
      Keywords:
        - "聊天"
        - "你好"
        - "最近"
      Prompt: "这是一个闲聊场景，请保持友好、轻松的对话风格。可以适当使用表情和幽默元素。"
      Priority: 5
```

每个场景提示词包含以下组件：

| 参数名 | 描述 | 示例 |
|-------|------|------|
| `Name` | 场景名称 | "问答场景" |
| `Keywords` | 触发该场景的关键词 | ["问题", "如何", "为什么"] |
| `Prompt` | 该场景的提示词 | "这是一个问答场景..." |
| `Priority` | 场景优先级（数字越大优先级越高） | 10 |

系统会根据消息内容和关键词，识别当前对话属于哪个场景，然后应用相应的场景提示词。如果多个场景匹配，系统会选择优先级最高的场景。

## 配置示例

以下是一个完整的提示词配置示例：

```yaml
Prompts:
  # 基本配置
  SystemPrompt: "你是一个名为 {bot_name} 的智能助手，你的任务是在群聊中自然地参与对话，提供有用的信息和友好的交流。你应该表现得像一个真实的群聊成员，而不是一个机械的AI助手。"
  PromptTemplate: |
    <system>
    {system_prompt}
    
    你的人格：{personality}
    当前时间：{current_time}
    群组名称：{group_name}
    </system>
    
    <context>
    {context}
    </context>
    
    <conversation>
    {conversation_history}
    </conversation>
    
    <current_message>
    发送者：{sender_name}
    消息：{current_message}
    </current_message>
  
  # 高级配置
  ContextEnhancement: true
  ContextEnhancementPrompt: "请根据以下对话历史，总结当前的讨论主题和关键信息：\n{conversation_history}"
  ResponseFormatting: true
  ResponseFormattingPrompt: "请以简洁、友好的方式回应，避免过长的回复，保持对话的自然流畅。使用自然的语气，就像你是群聊中的一个普通成员。"
  SpecialPrompts:
    Greeting: "有新用户加入群聊时，请简短地欢迎他们。可以询问他们的兴趣或者如何了解到这个群。"
    LongSilence: "当群聊长时间没有活动后，你可以适当地发起一些有趣的话题，比如最近的科技新闻、有趣的事实或者轻松的问题。"
    HighActivity: "当群聊非常活跃时，请保持简短的回应，不要打断对话流。只在你能提供有价值信息时才回应。"
  
  # 场景提示词
  ScenarioPrompts:
    - Name: "问答场景"
      Keywords:
        - "问题"
        - "如何"
        - "为什么"
        - "是什么"
        - "能否"
      Prompt: "这是一个问答场景，请提供准确、有帮助的回答。尽量使用事实和数据支持你的观点。如果你不确定答案，请诚实地表明。"
      Priority: 10
    
    - Name: "闲聊场景"
      Keywords:
        - "聊天"
        - "你好"
        - "最近"
        - "怎么样"
        - "有趣"
      Prompt: "这是一个闲聊场景，请保持友好、轻松的对话风格。可以适当使用表情和幽默元素，但不要过度。关注建立融洽的关系而不是提供信息。"
      Priority: 5
    
    - Name: "辩论场景"
      Keywords:
        - "辩论"
        - "观点"
        - "认为"
        - "同意"
        - "反对"
      Prompt: "这是一个辩论场景，请提供平衡、理性的观点。考虑多个角度，避免情绪化或极端的表达。尊重不同意见，使用逻辑和证据支持你的论点。"
      Priority: 8
```

## 最佳实践

1. **简洁明了**：系统提示词应该简洁明了，避免过长或复杂的指令
2. **结构清晰**：使用明确的标记（如 `<system>`、`<context>` 等）分隔提示词的不同部分
3. **变量灵活**：充分利用变量系统，使提示词能够适应不同的情境
4. **场景定制**：为常见的对话场景定制专门的提示词，提高回应的相关性
5. **定期优化**：根据机器人的实际表现，定期调整和优化提示词
6. **避免矛盾**：确保不同部分的提示词之间不存在矛盾或冲突
7. **保持一致**：提示词应该与机器人的人格设定保持一致

## 常见问题

### 机器人回应不符合预期风格

如果机器人的回应风格与预期不符，可能是因为：

1. 系统提示词没有明确指定期望的风格
2. 提示词模板结构不清晰
3. 人格描述与系统提示词不一致

解决方案：
- 在系统提示词中明确指定期望的回应风格
- 优化提示词模板结构，确保各部分清晰分隔
- 确保人格描述与系统提示词保持一致

### 机器人忽略了上下文

如果机器人在回应时忽略了对话上下文，可能是因为：

1. 提示词模板中的上下文部分格式不正确
2. 上下文增强功能未启用或配置不当
3. 对话历史部分的格式不利于模型理解

解决方案：
- 检查提示词模板中的上下文部分格式
- 启用并优化上下文增强功能
- 调整对话历史的格式，使其更易于模型理解

### 场景识别不准确

如果场景识别不准确，可能是因为：

1. 关键词设置不合适
2. 多个场景之间的优先级设置不合理
3. 关键词过于宽泛或过于具体

解决方案：
- 调整关键词列表，使其更准确地反映场景特征
- 重新设置场景优先级，确保最重要的场景有更高的优先级
- 平衡关键词的具体性和覆盖面
